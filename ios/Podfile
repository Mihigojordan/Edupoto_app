# Uncomment this line to define a global platform for your project
platform :ios, '13.0'

# CocoaPods analytics
ENV['COCOAPODS_DISABLE_STATS'] = 'true'

# Ignore all warnings from pods
inhibit_all_warnings!

# Use frameworks
use_frameworks!
use_modular_headers!

target 'Runner' do
  # Flutter Pod
  flutter_install_all_ios_pods File.dirname(File.realpath(__FILE__))

  # Post-install to enforce Swift version and optimization levels
  post_install do |installer|
    installer.pods_project.targets.each do |target|
      target.build_configurations.each do |config|
        # Set Swift version
        config.build_settings['SWIFT_VERSION'] = '5.8'  # Match your Xcode Swift version

        # Set optimization levels
        if config.name == 'Debug'
          config.build_settings['SWIFT_OPTIMIZATION_LEVEL'] = '-Onone'
        else
          config.build_settings['SWIFT_OPTIMIZATION_LEVEL'] = '-O'
        end

        # Ensure module stability for libraries
        config.build_settings['BUILD_LIBRARY_FOR_DISTRIBUTION'] = 'YES'
      end
    end
  end
end

# Flutter Pod helper method
def flutter_install_all_ios_pods(flutter_root)
  require File.join(flutter_root, 'packages', 'flutter_tools', 'bin', 'podhelper')
  install_all_ios_pods(flutter_root)
end
